<!DOCTYPE html>
<html lang="zh-Hant-TW">
  <head>
    <title>Samuel Meme</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <style>
      .card img {
        display: flex;
        justify-content: center;
      }

      .card .card-body {
        text-align: center;
      }

    </style>
  </head>
  <body>

    <div class="container mt-4">
      <h1 class="text-center">Samuel Meme</h1>
      <div id="cards" class="card-columns"></div>
    </div>

    <template id="card">
      <div class="card p-3">
        <div class="card-body">
          <h3 class="card-title"></h3>
        </div>
        <img class="card-img-top">
      </div>
    </template>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
    <script>
      fetch('https://api.github.com/repos/Yojahuang/samuel_meme/git/trees/master')
        .then(res => res.json())
        .then(res => {
          const ignore = ['.gitignore']
          const filetype = {
            'png': 'image/png',
            'jpg': 'image/jpeg',
            'jpeg': 'image/jpeg'
          }

          const files = res.tree.map(file => file.path).filter(file => !ignore.includes(file))

          const template = document.getElementById('card')

          files.forEach(file => {
            fetch(`https://api.github.com/repos/Yojahuang/samuel_meme/contents/${file}`)
              .then(res => res.json())
              .then(res => {
                const node = template.cloneNode(true)

                const img = node.content.querySelector('img')
                img.src = `data:${filetype[res.name.split('.').slice(-1)]};base64,${res.content}`

                const title = node.content.querySelector('.card-title')
                title.innerText = res.name.replace(/\.(png|jpg|jpeg)/g, '')

                document.getElementById('cards').appendChild(document.importNode(node.content, true))
              })
          })
        })
    </script>
  </body>
</html>
